{"version":3,"file":null,"sources":["../../src/utils/guid.js","../../src/model/states/chat.js","../../src/model/states/index.js","../../src/model/client-reducer.js","../../src/view/components/MessageLog.js","../../src/view/components/Message.js","../../src/view/states/chat.js","../../src/view/states/index.js","../../src/view/AppContainer.js","../../src/client/log.js","../../src/client/client-io.js","../../src/client/index.js"],"sourcesContent":["function s4() {\n  return Math.floor((1 + Math.random()) * 0x10000)\n    .toString(16)\n    .substring(1);\n}\n\nexport default function guid() {\n\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    s4() + '-' + s4() + s4() + s4()\n}\n","import {guid as guidGenerator} from '../../utils'\n\nexport const STATE_NAME = 'chat'\n\nexport const MESSAGE = 'CHAT:MESSAGE'\nexport const SET_PLAYER_NAME = 'CHAT:SET_PLAYER_NAME'\n\n/**\n *\n * @param {string} to\n * @param {string} message\n * @param {string} from\n * @returns {{type: string, id:string, from: string, guid: string|undefined, to: string, message: string}}\n */\nexport function messageAction(to, message, from) {\n  return {\n    type: MESSAGE,\n    id: guidGenerator(),\n    from: from,\n    guid: (to !== 'all' ? to : undefined),\n    to: to,\n    message: message\n  }\n}\n\nexport function setPlayerNameAction(playerName, guid) {\n  return {\n    type: SET_PLAYER_NAME,\n    guid: guid,\n    playerName: playerName\n  }\n}\n\nexport function playerNameSelector(state){\n  return state.name\n}\n\nconst initialState = {\n  name: STATE_NAME,\n  playerName: 'Noname',\n  messages: []\n}\n\nexport default function introduction(state = initialState, action) {\n  switch (action.type) {\n    case MESSAGE :\n      return {\n        ...state,\n        messages: state.messages.concat({\n          id: action.id,\n          from: action.from,\n          to: action.to,\n          message: action.message\n        })\n      }\n    case SET_PLAYER_NAME :\n      return {\n        ...state,\n        playerName: action.playerName\n      }\n    default :\n      return state\n  }\n}","//import rollDices from './roll-dices'\n//import introduction from './introduction'\n//import classSelection from './class-selection'\n//import townLobby from './town-lobby'\n//import assignDices from './assign-dices'\n//import battle from './battle'\nimport chat from './chat'\n\nexport {\n  //rollDices, introduction, classSelection, townLobby, assignDices, battle,\nchat}","import * as clientStateReducers from './states'\n\nexport const CLIENT_STATE_LOAD = 'CLIENT_STATE_LOAD'\nexport const CLIENT_STATE_PUSH = 'CLIENT_STATE_PUSH'\nexport const CLIENT_STATE_POP = 'CLIENT_STATE_POP'\n\nexport function pushClientStateAction(name, initialState, guid){\n  return {\n    type: CLIENT_STATE_PUSH ,\n    guid: guid,\n    name: name,\n    initialState : initialState\n  }\n}\n\nexport function popClientStateAction(returnState, guid) {\n  return {\n    type: CLIENT_STATE_POP,\n    guid: guid,\n    returnState : returnState\n  }\n}\n\nexport function loadClientStateAction(state, guid){\n  return {\n    type: CLIENT_STATE_LOAD,\n    guid : guid,\n    state: state\n  }\n}\n\n\n\nexport function currentClientStateSelector(state){\n  return state[state.length - 1]\n}\n\nexport function currentClientStateNameSelector(state){\n  return currentClientStateSelector(state).name\n}\n\nexport function clientStateSelector(state, name){\n  return state.find(s => s.name === name)\n}\n\n\n\nexport default function contextReducer(state = [], action) {\n  switch (action.type) {\n    case CLIENT_STATE_LOAD :\n      return action.state\n    case CLIENT_STATE_PUSH :\n      return state.concat(clientStateReducers[action.name](undefined, action))\n    case CLIENT_STATE_POP :\n      return state.slice(0,state.length-1)\n    default :{\n      if(state.length === 0) return state\n      const newState = state.map(s => clientStateReducers[s.name](s,action))\n      return newState.find((s,index)=> state[index] !== s) === undefined ? state : newState\n    }\n  }\n}\n","import css from './style.css'\nimport * as React from 'react'\n\nexport default class MessageLog extends React.Component {\n\n  constructor() {\n    super()\n  }\n\n  componentDidUpdate(){\n    this.refs.messages.scrollTop = this.refs.messages.scrollHeight\n    this.refs.chatInput.focus()\n  }\n\n  render(){\n\n\n    let handleClick = ()=>{\n      this.props.onSend(this.refs.chatInput.value)\n      this.refs.chatInput.value = ''\n    }\n\n    let handleKeyboard = (e)=>{\n      if (e.key === 'Enter') {\n        handleClick()\n      }\n    }\n\n    return <div className={`${this.props.className} ${css.messageLogContainer}`}>\n      <div key=\"list\" ref=\"messages\" className={css.messageLogContainerList}>\n        { this.props.children }\n      </div>\n      <input key=\"input\" className={css.messageLogContainerInput} ref=\"chatInput\" onKeyUp={handleKeyboard}></input>\n      <button key=\"send\" className={css.messageLogContainerSend} onClick={handleClick} >Send</button>\n    </div>\n  }\n}","import css from './style.css'\nimport * as React from 'react'\n\nexport default function Message({id, from, message}){\n  return <div key={id}><span className={css.messageAuthorName}>{from}</span>:{message}</div>\n}","import {STATE_NAME as CHAT_STATE_NAME, messageAction, setPlayerNameAction} from '../../model/states/chat'\nimport css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\n\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\nimport {clientStateSelector} from '../../model/client-reducer'\n\nclass IntroductionComponent extends  React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend} = this.props\n\n    return <div className={`${css.defaultState} ${css.introductionState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => {dispatch(setPlayerNameAction(command))}\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    messages: clientStateSelector(state, CHAT_STATE_NAME).messages\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(IntroductionComponent)\n","//import introduction from './introduction'\n//import classSelection from './class-selection'\n//import townLobby from './town-lobby'\n//import rollDices from './roll-dices'\n//import assignDices from './assign-dices'\n//import battle from './battle'\nimport chat from './chat'\n\nexport {\n  //introduction, classSelection, townLobby, rollDices, assignDices, battle,\nchat}","import * as React from 'react'\nimport {connect} from 'react-redux'\nimport {currentClientStateSelector} from '../model/client-reducer'\n\nimport * as clientStates from './states'\n\nclass AppContainer extends React.Component {\n  constructor() {\n    super()\n  }\n\n  render(){\n    const {clientState} = this.props\n    if(!clientState) return <div>Loading...</div>\n\n    const StateContainer = clientStates[clientState.name]\n    return <StateContainer />\n  }\n}\n\nconst mapDispatchToProps = function(dispatch) {\n  return {\n  }\n}\n\nconst mapStateToProps = function(state) {\n  return {\n    clientState: currentClientStateSelector(state)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AppContainer)","export default {\n  debug(...args){\n    console.debug(...args)\n  },\n  info(...args){\n    console.info(...args)\n  },\n  warn(...args){\n    console.warn(...args)\n  },\n  error(...args){\n    console.error(...args)\n  }\n}","import guid from '../utils/guid'\nimport log from './log'\nimport {loadClientStateAction} from '../model/client-reducer'\n\nexport default function command({ getState, dispatch }) {\n  const socket = io()\n\n  let authToken = localStorage.getItem('auth-token')\n  if(!authToken){\n    authToken = guid()\n    localStorage.setItem('auth-token', authToken)\n  }\n\n  socket.on('connect', function onConnect(){\n    log.info('connected')\n    socket.emit('authentication', authToken)\n  })\n\n  socket.on('initial_state', function onInitialState(state){\n    log.info('initial_state', state)\n    dispatch(loadClientStateAction(state))\n  })\n\n  socket.on('action', function onAction(action){\n    dispatch(action)\n  })\n\n  return (next) => (action) => {\n    const actionJSON = JSON.stringify(action)\n    log.info(`Action: ${actionJSON}`)\n    if(action.type === 'COMMAND_REQUEST'){\n      socket.emit('command_request', action)\n      return {}\n    } else {\n      return next(action)\n    }\n  }\n}\n","/*global __REDUX_DEVTOOLS_EXTENSION_COMPOSE__ */\n\nimport AppContainer from '../view/AppContainer'\nimport contextReducer from '../model/client-reducer'\nimport commandMiddleware from './client-io'\nimport {createStore, applyMiddleware, compose} from 'redux'\nimport {Provider} from 'react-redux'\nimport * as ReactDOM from 'react-dom'\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\nconst store = createStore(contextReducer, composeEnhancers(applyMiddleware(commandMiddleware)))\n\nReactDOM.render(\n    <Provider store={store}>\n      <AppContainer></AppContainer>\n    </Provider>\n    ,document.getElementById('mount'))\n"],"names":["s4","Math","floor","random","toString","substring","guid","STATE_NAME","MESSAGE","SET_PLAYER_NAME","setPlayerNameAction","playerName","initialState","introduction","state","action","type","messages","concat","id","from","to","message","CLIENT_STATE_LOAD","CLIENT_STATE_PUSH","CLIENT_STATE_POP","loadClientStateAction","currentClientStateSelector","length","clientStateSelector","name","find","s","contextReducer","clientStateReducers","undefined","slice","newState","map","index","MessageLog","React","refs","scrollTop","scrollHeight","chatInput","focus","handleClick","props","onSend","value","handleKeyboard","e","key","React.createElement","className","css","messageLogContainer","messageLogContainerList","children","messageLogContainerInput","messageLogContainerSend","Message","messageAuthorName","IntroductionComponent","defaultState","introductionState","chat","mapStateToDispatch","dispatch","command","mapStateToProps","CHAT_STATE_NAME","connect","AppContainer","clientState","StateContainer","clientStates","mapDispatchToProps","args","debug","info","warn","error","getState","socket","io","authToken","localStorage","getItem","setItem","on","onConnect","emit","onInitialState","onAction","next","actionJSON","JSON","stringify","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","commandMiddleware","ReactDOM","document","getElementById"],"mappings":"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"}