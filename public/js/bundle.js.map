{"version":3,"file":null,"sources":["../../src/utils/guid.js","../../src/utils/shallow-equal.js","../../src/utils/changed.js","../../src/utils/filter-first.js","../../src/model/client-action-state/roll-dices.js","../../src/model/client-action-state/introduction.js","../../src/model/client-action-state/class-selection.js","../../src/model/client-action-state/town-lobby.js","../../src/model/client-action-state/assign-dices.js","../../src/model/client-action-state/battle.js","../../src/model/action-state-reducer.js","../../src/model/context-reducer.js","../../src/view/components/MessageLog.js","../../src/view/components/Message.js","../../src/view/states/introduction.js","../../src/view/states/class-selection.js","../../src/view/states/town-lobby.js","../../src/view/layout/HorizontalList.js","../../src/view/components/Dice.js","../../src/view/components/DiceSlot.js","../../src/view/components/Action.js","../../src/view/states/roll-dices.js","../../src/view/states/assign-dices.js","../../src/view/states/battle.js","../../src/view/AppContainer.js","../../src/model/global-reducer.js","../../src/client/log.js","../../src/client/client-io.js","../../src/client/index.js"],"sourcesContent":["function s4() {\n  return Math.floor((1 + Math.random()) * 0x10000)\n    .toString(16)\n    .substring(1);\n}\n\nexport default function guid() {\n\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    s4() + '-' + s4() + s4() + s4()\n}\n","export default function shallowEqual(oldState, newState){\n  const resultOldToNew = Object.keys(oldState).reduce((result, oldKey) => {\n    return result === true ? result : oldState[oldKey] !== newState[oldKey]\n  }, false)\n\n  const resultNewToOld = Object.keys(newState).reduce((result, newKey) => {\n    return result === true ? result : oldState[newKey] !== newState[newKey]\n  }, false)\n\n  return !resultNewToOld && !resultOldToNew\n}","import shallowEqual from './shallow-equal'\n\nexport default function changed(oldState, newState){\n\n  return shallowEqual(oldState, newState) ? oldState : newState\n}","export default function filterFirst(array, element){\n  let found = false\n  let newArray= []\n  array.forEach(el => {\n    if(el != element || found){\n      newArray.push(el)\n    } else {\n      found = true\n    }\n  })\n  return newArray\n}","const ROLL = 'ROLL_DICES:ROLL'\nconst LOCK = 'ROLL_DICES:LOCK'\n\n\nexport function rollAction(guid, rolledDices) {\n  return {\n    type: ROLL,\n    guid: guid,\n    rolledDices: rolledDices\n  }\n}\nexport function lockAction(guid, locks) {\n  return {\n    type: LOCK,\n    guid: guid,\n    locks: locks\n  }\n}\n\nexport function numberOfRerollsSelector(state){\n  return state.numberOfRolls\n}\n\nexport function rolledDicesSelector(state) {\n  return state.rolledDices\n}\n\nexport function locksSelector(state){\n  return state.locks\n}\n\n\nconst initialState = {\n  name: 'rollDices',\n  rolledDices: [],\n  locks:[],\n  numberOfRolls: 0\n}\n\nexport default function rollDices(state = initialState, action) {\n  switch (action.type) {\n    case ROLL:\n      return {\n        ...state,\n        rolledDices: action.rolledDices,\n        numberOfRolls: (state.numberOfRolls+1)\n      }\n    case LOCK:\n      return {\n        ...state,\n        locks : action.locks\n      }\n    default :\n      return state\n  }\n}","const initialState = {\n  name: 'introduction'\n}\n\nexport default function introduction(state = initialState, action) {\n  switch (action.type) {\n    default :\n      return state\n  }\n}","const initialState = {\n  name: 'classSelection'\n}\n\nexport default function classSelection(state = initialState, action) {\n  switch (action.type) {\n    default :\n      return state\n  }\n}","const initialState = {\n  name: 'townLobby'\n}\n\nexport default function townLobby(state = initialState, action) {\n  switch (action.type) {\n    default :\n      return state\n  }\n}","import {filterFirst} from '../../utils'\n\nconst CLIENT_STATE_ENTER_PUSH = 'CLIENT_STATE_ENTER_PUSH'\nconst ASSIGN_DICE = 'ASSIGN_DICES:ASSIGN_DICE'\nconst RESET = 'ASSIGN_DICES:RESET'\n\nexport function rolledDicesSelector(state){\n  return state.rolledDices\n}\n\nexport function currentDicesSelector(state){\n  return state.currentDices\n}\n\nexport function assignedActionsSelector(state){\n  return state.actions\n}\n\nfunction slotsReducer(state = [], action) {\n  switch (action.type) {\n    case ASSIGN_DICE : {\n      const newArray = state.slice(0)\n      newArray[action.slotIndex] = action.dice\n      return newArray\n    }\n    default :\n      return state\n  }\n}\n\nfunction actionsReducer(state = [], action) {\n  switch (action.type) {\n    case ASSIGN_DICE : {\n      const newArray = state.slice(0)\n      newArray[action.actionIndex] = slotsReducer(state[action.actionIndex], action)\n      return newArray\n    }\n    default :\n      return state\n  }\n}\n\n\nexport function assignDiceAction(guid, actionIndex, slotIndex, dice) {\n  return {\n    type: ASSIGN_DICE,\n    guid: guid,\n    actionIndex: actionIndex,\n    slotIndex: slotIndex,\n    dice: dice\n  }\n}\n\nexport function resetAction(guid) {\n  return {\n    type: RESET,\n    guid: guid\n  }\n}\n\n\nconst initialState = {\n  name: 'assignDices',\n  rolledDices: [],\n  currentDices: [],\n  actions: []\n}\nexport default function assignDices(state = initialState, action) {\n  switch (action.type) {\n    case CLIENT_STATE_ENTER_PUSH :\n      return {\n        ...state,\n        rolledDices: action.initialState.rolledDices,\n        currentDices : action.initialState.rolledDices\n      }\n    case ASSIGN_DICE :\n      return {\n        ...state,\n        actions: actionsReducer(state.actions, action),\n        currentDices : filterFirst(state.currentDices, action.dice)\n      }\n    case RESET : return {\n      ...state,\n      currentDices : state.rolledDices,\n      actions: []\n    }\n\n    default :\n      return state\n  }\n}","const initialState = {\n  name: 'battle',\n  battlefield:[{\n    id:'group1',\n    unitrefs: ['orc1', 'orc2'],\n  },{\n    id:'group2',\n    unitrefs: ['orc3','goblin1','goblin2']\n  },{\n    id:'group3',\n    unitrefs:[]\n  }],\n  units :{\n    'orc1' : {\n      hp : {\n        current: 10,\n        max: 10\n      }\n    },\n    'orc2':{\n      hp : {\n        current: 10,\n        max: 10\n      }\n    },\n    'orc3':{\n      hp : {\n        current: 10,\n        max: 10\n      }\n    },\n    'goblin1':{\n      hp : {\n        current: 10,\n        max: 10\n      }\n    },\n    'goblin2':{\n      hp : {\n        current: 10,\n        max: 10\n      }\n    }\n  }\n}\n\nexport default function battle(state = initialState, action) {\n  switch (action.type) {\n    default :\n      return state\n  }\n}","import {shallowEqual} from '../utils'\nimport * as clientActionReducers from './client-action-state'\n\nconst CLIENT_STATE_ENTER_PUSH = 'CLIENT_STATE_ENTER_PUSH'\nconst CLIENT_STATE_POP = 'CLIENT_STATE_POP'\nconst CLIENT_STATE_ENTER_REPLACE = 'CLIENT_STATE_ENTER_REPLACE'\n\nexport function pushStateAction(guid, name, initialState){\n  return {\n    type: CLIENT_STATE_ENTER_PUSH ,\n    guid: guid,\n    name: name,\n    initialState : initialState\n  }\n}\n\nexport function popStateAction(guid) {\n  return {\n    type: CLIENT_STATE_POP,\n    guid: guid\n  }\n}\n\nexport function setStateAction(guid, name){\n  return {\n    type : CLIENT_STATE_ENTER_REPLACE,\n    guid : guid,\n    name : name\n  }\n}\n\nexport default function actionStateReducer(state = [], action) {\n  switch (action.type) {\n    case CLIENT_STATE_ENTER_PUSH :\n      return state.concat(clientActionReducers[action.name](undefined, action))\n    case CLIENT_STATE_POP :\n      return state.slice(0,state.length-1)\n    case CLIENT_STATE_ENTER_REPLACE :\n      return state.slice(0,state.length-1).concat(clientActionReducers[action.name](undefined, {type:'@INIT@'}))\n    default :{\n      if(state.length === 0) return state\n      const topState = state[state.length - 1]\n      const topStateName = topState.name\n      const reducer = clientActionReducers[topStateName]\n      if(reducer){\n        const newTopState = reducer(topState, action)\n        if(shallowEqual(topState, newTopState)){\n          return state\n        } else {\n          return state.slice(0,state.length-1).concat(newTopState)\n        }\n      }\n      return state\n    }\n  }\n}","import {guid as guidGenerator} from '../utils'\nimport {changed} from '../utils'\nimport actionStateReducer from './action-state-reducer'\n\n\nexport function messageAction(from, to, message) {\n  return {\n    type: 'MESSAGE',\n    id: guidGenerator(),\n    from: from,\n    guid: (to !== 'all' ? to : undefined),\n    to: to,\n    message: message\n  }\n}\n\nexport function setNameAction(guid, name) {\n  return {\n    type: 'CLIENT_SET_NAME',\n    guid: guid,\n    name: name\n  }\n}\n\nexport function setClassAction(guid, className) {\n  return {\n    type: 'CLIENT_SET_CLASS',\n    guid: guid,\n    name: className\n  }\n}\n\nexport function nameSelector(state){\n  return state.name\n}\n\nexport function classNameSelector(state){\n  return state.className\n}\n\nexport function idSelector(state){\n  return `${nameSelector(state)}[${classNameSelector(state)}]`\n}\n\nexport function actionsSelector(state){\n  return state.actions\n}\n\nexport function actionStateSelector(state){\n  return state.actionState\n}\n\nexport function actionStateCountSelector(state){\n  return actionStateSelector(state).length\n}\n\nexport function currentActionStateSelector(state){\n  return state.actionState[state.actionState.length - 1]\n}\n\nexport function currentActionStateNameSelector(state){\n  return currentActionStateSelector(state).name\n}\n\n\nconst initialState = {\n  name: 'Noname',\n  className: 'Noone',\n  actionState: [],\n  actions: [\n    {\n      name: 'Shield',\n      slots: [{\n        require: 1\n      }]\n    },\n    {\n      name: 'Maneuver',\n      slots: [{\n        require: 3\n      }]\n    },\n    {\n      name: 'Throw',\n      slots: [{\n        require: 6\n      }]\n    },\n    {\n      name: 'Fireball',\n      slots: [\n        {\n          require: 5\n        },\n        {\n          require: 6\n        }\n      ]\n    }\n  ],\n  messages: [{\n    id: guidGenerator(),\n    from: 'Chat System',\n    to: 'all',\n    message: 'Welcome to chat'\n  }]\n}\n\nexport default function contextReducer(state = initialState, action) {\n  switch (action.type) {\n    case 'MESSAGE' :\n      return {\n        ...state,\n        messages: state.messages.concat({\n          id: action.id,\n          from: action.from,\n          to: action.to,\n          message: action.message\n        })\n      }\n    case 'CLIENT_SET_NAME' :\n      return {\n        ...state,\n        name: action.name\n      }\n    case 'CLIENT_SET_CLASS' :\n      return {\n        ...state,\n        className: action.name\n      }\n    case 'LOAD_CLIENT_STATE' :\n      return action.state\n    default:\n      return changed(state, {\n        ...state,\n        actionState: actionStateReducer(state.actionState, action)\n      })\n  }\n}\n","import css from './style.css'\nimport * as React from 'react'\n\nexport default class MessageLog extends React.Component {\n\n  constructor() {\n    super()\n  }\n\n  componentDidUpdate(){\n    this.refs.messages.scrollTop = this.refs.messages.scrollHeight\n    this.refs.chatInput.focus()\n  }\n\n  render(){\n\n\n    let handleClick = ()=>{\n      this.props.onSend(this.refs.chatInput.value)\n      this.refs.chatInput.value = ''\n    }\n\n    let handleKeyboard = (e)=>{\n      if (e.key === 'Enter') {\n        handleClick()\n      }\n    }\n\n    return <div className={`${this.props.className} ${css.messageLogContainer}`}>\n      <div key=\"list\" ref=\"messages\" className={css.messageLogContainerList}>\n        { this.props.children }\n      </div>\n      <input key=\"input\" className={css.messageLogContainerInput} ref=\"chatInput\" onKeyUp={handleKeyboard}></input>\n      <button key=\"send\" className={css.messageLogContainerSend} onClick={handleClick} >Send</button>\n    </div>\n  }\n}","import css from './style.css'\nimport * as React from 'react'\n\nexport default function Message({id, from, message}){\n  return <div key={id}><span className={css.messageAuthorName}>{from}</span>:{message}</div>\n}","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\n\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\n\nclass IntroductionComponent extends  React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend} = this.props\n\n    return <div className={`${css.defaultState} ${css.introductionState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command})\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    messages: state.messages\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(IntroductionComponent)\n","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\n\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\n\nclass ClassSelectionComponent extends  React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend} = this.props\n\n    return <div className={`${css.defaultState} ${css.classSelectionState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command})\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    messages: state.messages\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(ClassSelectionComponent)","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\n\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\n\nclass TownLobbyComponent extends  React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend} = this.props\n\n    return <div className={`${css.defaultState} ${css.townLobbyState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command})\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    messages: state.messages\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(TownLobbyComponent)\n","import css from './style.css'\nimport * as React from 'react'\n\nexport default function HorizontalList({className, children}) {\n  return <div className={`${className} ${css.horizontalList}`}>\n    {children}\n  </div>\n}","import css from 'style.css'\nimport * as React from 'react'\n\nexport default function Dice({\n  className,\n  face,\n  lock,\n  onClick\n}) {\n\n  const imagePath = `/public/img/dices/${face}_dots.png`\n\n  return <div className={`${className} ${css.dice} ${lock ? css.diceLocked : ''}`}\n              onClick={onClick}>\n    <img src={imagePath} width=\"32px\" height=\"32px\"></img>\n  </div>\n}\n","import css from 'style.css'\nimport * as React from 'react'\n\nexport default function DiceSlot({\n  className,\n  face,\n  onClick, children\n}) {\n\n  const imagePath = `url(/public/img/dices/${face}_dots_slot.png)`\n  const style = {\n    background: imagePath,\n    backgroundSize: '32px 32px',\n    backgroundRepeat: 'no-repeat'\n  }\n\n  return <div className={`${className} ${css.diceSlot}`}\n              onClick={onClick} style={style}>\n    {children}\n  </div>\n}","import css from './style.css'\nimport * as React from 'react'\n\nexport default function Action({className, name, children}){\n  return <div className={`${className} ${css.actionComponent}`}>\n    {name}\n    <div className={css.diceSlot}>{children}</div>\n  </div>\n}\n","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\nimport {currentActionStateSelector} from '../../model/context-reducer'\n\nimport HorizontalList from '../layout/HorizontalList'\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\n\nimport Dice from '../components/Dice'\nimport DiceSlot from '../components/DiceSlot'\nimport Action from '../components/Action'\n\nclass RollDicesContainer extends  React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend, onReroll, onLock, dices, locks, actions} = this.props\n\n    return <div className={`${css.defaultState} ${css.rollDicesState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n      <HorizontalList className={css.dicepool}>\n        <button className={css.rerollButton} onClick={(event)=>{onReroll()}}>Reroll dices</button>\n        {dices.map((number, index)=><Dice className={css.diceSpace} key={index} face={number} lock={locks[index]} onClick={onLock.bind(undefined,index)}></Dice>)}\n      </HorizontalList>\n      <HorizontalList className={css.actionpool}>\n        {actions.map((action, actionIndex) =>\n          <Action key={actionIndex} name={action.name}>\n            {action.slots.map((slot, slotIndex) => <DiceSlot key={slotIndex} face={slot.require}>\n            </DiceSlot>)}\n          </Action>)}\n      </HorizontalList>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command}),\n  onReroll : ()=> dispatch({type: 'COMMAND_REQUEST', command: '/reroll'}),\n  onLock:(index)=>dispatch({type: 'COMMAND_REQUEST', command: `/lock ${index}`})\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    dices : currentActionStateSelector(state).rolledDices,\n    locks : currentActionStateSelector(state).locks,\n    messages: state.messages,\n    actions: state.actions\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(RollDicesContainer)\n","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\nimport {currentActionStateSelector} from '../../model/context-reducer'\n\nimport HorizontalList from '../layout/HorizontalList'\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\nimport Dice from '../components/Dice'\nimport DiceSlot from '../components/DiceSlot'\nimport Action from '../components/Action'\nimport {currentDicesSelector, assignedActionsSelector} from '../../model/client-action-state/assign-dices'\n\nclass AssignActionsContainer extends React.Component {\n  constructor() {\n    super()\n  }\n\n  renderDice(actions, actionIndex, slotIndex){\n    const action = actions[actionIndex]\n    if(!action) return undefined\n    const dice = action[slotIndex]\n    if(dice){\n      return <Dice face={dice}/>\n    } else {\n      return undefined\n    }\n  }\n\n  render() {\n    const {messages, onSend, onReset, onAssign, onDone, dices, actions, assignedActions} = this.props\n    return <div className={`${css.defaultState} ${css.assignDicesState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from}\n                                                        message={message}/>)}\n      </MessageLog>\n      <HorizontalList className={css.dicepool}>\n        <button className={css.midButton} onClick={onReset}>Reset dices</button>\n        <button className={css.midButton} onClick={onDone}>Done</button>\n        {dices.map((number, index) => <Dice className={css.diceSpace} key={index} face={number}/>)}\n      </HorizontalList>\n      <HorizontalList className={css.actionpool}>\n        {actions.map((action, actionIndex) =>\n          <Action key={actionIndex} name={action.name}>\n            {action.slots.map((slot, slotIndex) => <DiceSlot key={slotIndex} face={slot.require}\n                                                             onClick={onAssign.bind(undefined, actionIndex, slotIndex)}>\n              { this.renderDice(assignedActions, actionIndex, slotIndex)}\n            </DiceSlot>)}\n          </Action>)}\n      </HorizontalList>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => {\n  return {\n    onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command}),\n    onReset: () => dispatch({type: 'COMMAND_REQUEST', command: '/reset'}),\n    onDone: () => dispatch({type: 'COMMAND_REQUEST', command: '/done'}),\n    onAssign: (actionIndex, slotIndex) => dispatch({\n      type: 'COMMAND_REQUEST',\n      command: `/assign ${actionIndex} ${slotIndex}`\n    })\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    dices: currentDicesSelector(currentActionStateSelector(state)),\n    assignedActions : assignedActionsSelector(currentActionStateSelector(state)),\n    messages: state.messages,\n    actions: state.actions\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(AssignActionsContainer)","import css from './style.css'\nimport * as React from 'react'\nimport {connect} from 'react-redux'\n\nimport MessageLog from '../components/MessageLog'\nimport Message from '../components/Message'\n\nclass BattleComponent extends React.Component {\n  constructor() {\n    super()\n  }\n\n  render() {\n    const {messages, onSend} = this.props\n\n    return <div className={`${css.defaultState} ${css.townLobbyState}`}>\n      <MessageLog onSend={onSend} className={css.chat}>\n        {messages.map(({id, from, message}) => <Message key={id} from={from} message={message}></Message>)}\n      </MessageLog>\n    </div>\n  }\n}\n\nconst mapStateToDispatch = (dispatch) => { return {\n  onSend: (command) => dispatch({type: 'COMMAND_REQUEST', command: command})\n} }\n\nconst mapStateToProps = (state) => {\n  return {\n    messages: state.messages\n  }\n}\n\nexport default connect(mapStateToProps, mapStateToDispatch)(BattleComponent)","import * as React from 'react'\nimport {connect} from 'react-redux'\nimport {currentActionStateSelector} from '../model/context-reducer'\n\nimport * as clientStates from './states'\n\nclass AppContainer extends React.Component {\n  constructor() {\n    super()\n  }\n\n  render(){\n    const {clientState} = this.props\n    if(!clientState) return <div>Loading...</div>\n\n    const StateContainer = clientStates[clientState.name]\n    return <StateContainer />\n  }\n}\n\nconst mapDispatchToProps = function(dispatch) {\n  return {\n  }\n}\n\nconst mapStateToProps = function(state) {\n  return {\n    clientState: currentActionStateSelector(state)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AppContainer)","import sharedContextReducer from './context-reducer'\nimport {combineReducers} from 'redux'\nimport {changed} from '../utils'\n\nexport function clientSelector(rootState, guid){\n  return rootState.contexts[guid].shared\n}\n\nconst initialState = {\n  connected : false,\n  shared : sharedContextReducer(undefined, {type:'@INIT@'})\n}\n\nfunction clientContextReducer(state = initialState, action){\n  switch (action.type){\n    case 'CONTEXT_SPAWNED': return {\n      shared : sharedContextReducer(state.shared, action),\n      connected: true\n    }\n    case 'CONTEXT_DESPAWNED': return {\n      shared: sharedContextReducer(state.shared, action),\n      connected: false\n    }\n    default : return changed(state, {\n      ...state,\n      shared : sharedContextReducer(state.shared, action)\n    })\n  }\n}\n\nfunction allContextsReducer(state = {}, action){\n  switch(action.type){\n    case 'CONTEXT_SPAWNED': return {...state, [action.guid]: clientContextReducer(state[action.guid], action)}\n    case 'CONTEXT_DESPAWNED': return {...state, [action.guid]: clientContextReducer(state[action.guid], action)}\n    default : return changed(state, Object.keys(state).reduce((newState, context) => {\n      if(action.guid){\n        if(!context) throw Error('Should not be null')\n        if(action.guid === context){\n          newState[context] = clientContextReducer(state[context], action)\n        } else {\n          newState[context] = state[context]\n        }\n      } else {\n        newState[context] = clientContextReducer(state[context], action)\n      }\n\n      return newState\n    }, {}))\n  }\n}\n\nexport default combineReducers({\n  contexts : allContextsReducer\n})\n","export default {\n  debug(...args){\n    console.debug(...args)\n  },\n  info(...args){\n    console.info(...args)\n  },\n  warn(...args){\n    console.warn(...args)\n  },\n  error(...args){\n    console.error(...args)\n  }\n}","import guid from '../utils/guid'\nimport log from './log'\n\nexport default function command({ getState, dispatch }) {\n  const socket = io()\n\n  let authToken = localStorage.getItem('auth-token')\n  if(!authToken){\n    authToken = guid()\n    localStorage.setItem('auth-token', authToken)\n  }\n\n  socket.on('connect', function onConnect(){\n    log.info('connected')\n    socket.emit('authentication', authToken)\n  })\n\n  socket.on('initial_state', function onInitialState(state){\n    log.info('initial_state', state)\n    dispatch({\n      type: 'LOAD_CLIENT_STATE',\n      state: state\n    })\n  })\n\n  socket.on('action', function onAction(action){\n    dispatch(action)\n  })\n\n  return (next) => (action) => {\n    const actionJSON = JSON.stringify(action)\n    log.info(`Action: ${actionJSON}`)\n    if(action.type === 'COMMAND_REQUEST'){\n      socket.emit('command_request', action)\n      return {}\n    } else {\n      return next(action)\n    }\n  }\n}\n","/*global __REDUX_DEVTOOLS_EXTENSION_COMPOSE__ */\n\nimport AppContainer from '../view/AppContainer'\nimport {contextReducer} from '../model'\nimport commandMiddleware from './client-io'\nimport {createStore, applyMiddleware, compose} from 'redux'\nimport {Provider} from 'react-redux'\nimport * as ReactDOM from 'react-dom'\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\nconst store = createStore(contextReducer, composeEnhancers(applyMiddleware(commandMiddleware)))\n\nReactDOM.render(\n    <Provider store={store}>\n      <AppContainer></AppContainer>\n    </Provider>\n    ,document.getElementById('mount'))\n"],"names":["s4","Math","floor","random","toString","substring","guid","shallowEqual","oldState","newState","resultOldToNew","Object","keys","reduce","result","oldKey","resultNewToOld","newKey","changed","filterFirst","array","element","found","newArray","forEach","el","push","ROLL","LOCK","initialState","rollDices","state","action","type","rolledDices","numberOfRolls","locks","introduction","classSelection","townLobby","CLIENT_STATE_ENTER_PUSH","ASSIGN_DICE","RESET","currentDicesSelector","currentDices","assignedActionsSelector","actions","slotsReducer","slice","slotIndex","dice","actionsReducer","actionIndex","assignDices","battle","CLIENT_STATE_POP","CLIENT_STATE_ENTER_REPLACE","actionStateReducer","concat","clientActionReducers","name","undefined","length","topState","topStateName","reducer","newTopState","currentActionStateSelector","actionState","guidGenerator","contextReducer","messages","id","from","to","message","MessageLog","React","refs","scrollTop","scrollHeight","chatInput","focus","handleClick","props","onSend","value","handleKeyboard","e","key","React.createElement","className","css","messageLogContainer","messageLogContainerList","children","messageLogContainerInput","messageLogContainerSend","Message","messageAuthorName","IntroductionComponent","defaultState","introductionState","chat","map","mapStateToDispatch","dispatch","command","mapStateToProps","connect","ClassSelectionComponent","classSelectionState","TownLobbyComponent","townLobbyState","HorizontalList","horizontalList","Dice","imagePath","face","lock","diceLocked","onClick","DiceSlot","style","diceSlot","Action","actionComponent","RollDicesContainer","onReroll","onLock","dices","rollDicesState","dicepool","rerollButton","event","number","index","diceSpace","bind","actionpool","slots","slot","require","AssignActionsContainer","onReset","onAssign","onDone","assignedActions","assignDicesState","midButton","renderDice","BattleComponent","AppContainer","clientState","StateContainer","clientStates","mapDispatchToProps","sharedContextReducer","clientContextReducer","shared","allContextsReducer","context","Error","combineReducers","args","debug","info","warn","error","getState","socket","io","authToken","localStorage","getItem","setItem","on","onConnect","emit","onInitialState","onAction","next","actionJSON","JSON","stringify","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","commandMiddleware","ReactDOM","document","getElementById"],"mappings":"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"}